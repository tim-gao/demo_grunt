/*! cruise 10-04-2017 */
requirejs.config({baseUrl:"",i18n:{locale:"zh-cn"},paths:{jquery:"scripts/jquery-3.2.0",bootstrap:"bootstrap-3.3.7/js/bootstrap","jquery.validate":"scripts/jquery.validate.min",handlebars:"scripts/handlebars-v4.0.5",my_cruise:"src/my_cruise"},shim:{bootstrap:{deps:["jquery"]},"jquery.validate":{deps:["jquery"]}}}),requirejs(["jquery","bootstrap","my_cruise"]),define(["jquery","handlebars","jquery.validate"],function(a,b){({init:function(){this._getSource(),this._bindEvent(),this._collection(),a(document).ready(function(){a("#inputForm").validate({rules:{inputBox:"required",minlength:2},messages:{inputBox:"Please input any resources!"},ignore:".ignore",errorPlacement:function(b,c){a("#inputForm").find(".error-panel").html(a(b))}})})},_getSource:function(b){var c=this,d=a(".menu-list .button.active"),e=d.data("filter"),f={list:[{isDeny:!0,filterType:"physical",img:"",infor:{name:"bjstdmngbgr02.thoughtworks.com",status:"idle",ipaddress:"192.168.1.2",path:"/var/lib/cruise-agent"}},{isDeny:!1,filterType:"physical",img:"",infor:{name:"bjstdmngbgr03.thoughtworks.com",status:"building",ipaddress:"192.168.1.3",path:"/var/lib/cruise-agent"}},{isDeny:!1,filterType:"physical",img:"",infor:{name:"bjstdmngbgr04.thoughtworks.com",status:"building",ipaddress:"192.168.1.4",path:"/var/lib/cruise-agent"}},{isDeny:!0,filterType:"physical",img:"",infor:{name:"bjstdmngbgr05.thoughtworks.com",status:"idle",ipaddress:"192.168.1.5",path:"/var/lib/cruise-agent"}},{isDeny:!1,filterType:"virtual",img:"",infor:{name:"bjstdmngbgr06.thoughtworks.com",status:"building",ipaddress:"192.168.1.6",path:"/var/lib/cruise-agent"}},{isDeny:!0,filterType:"virtual",img:"",infor:{name:"bjstdmngbgr07.thoughtworks.com",status:"idle",ipaddress:"192.168.1.7",path:"/var/lib/cruise-agent"}}]};c._renderInfos(f),c._filterList(e)},_filterList:function(b){var c=this;if("all"===b)return a(".infor-container").find("li").show(),void c._collection();a(".infor-container").find("li").each(function(c,d){a(d).data("filter-value")===b?a(d).show():a(d).hide()}),c._collection()},_collection:function(){var b=a(".infor-container").find("li"),c=0,d=0;b.each(function(b,e){"idle"==a(e).data("status")&&a(e).is(":visible")?c++:"building"==a(e).data("status")&&a(e).is(":visible")&&d++}),a(".summary-item.building .account").text(d),a(".summary-item.idle .account").text(c)},_renderInfos:function(c){var d=a("#item_tpl").html(),e=b.compile(d),f=a("ul.infor-container"),g="";a.isEmptyObject(c)||(g=e(c)),f.html(g)},_bindEvent:function(){var b=this;a(document).on("click","#all_btn",function(){b._filterList(a(this).data("filter"))}),a(document).on("click","#physical_btn",function(){b._filterList(a(this).data("filter"))}),a(document).on("click","#Virtual_btn",function(){b._filterList(a(this).data("filter"))}),a(document).on("change",".infor-container",function(){b._collection()}),a(document).on("click",".logout",function(){}),a(document).on("click",".spe-resours",function(){var b=a(this),c=b.offset().top,d=b.offset().left,e=a(".common-specify-container"),f=e.find(".input-box"),g=b.closest(".infor").height(),h=a(".overlay"),i=a(this).closest("li.list-item").prop("id");return e.css({top:c+g,left:d}),e.show(),e.data("belongs",i),h.show(),f.focus(),!1}),a(document).on("click",".resources-list  .glyphicon-remove",function(b){a(this);return a("#waring_modal").data("anchor",a(b.target)),a("#waring_modal").modal("show"),!1}),a(document).on("click","#waring_modal .close-btn",function(){a(this);return a("#waring_modal").modal("hide"),!1}),a(document).on("click","#waring_modal .yes-btn",function(){var c=(a(this),a("#waring_modal"));return anchorE=c.data("anchor"),c.modal("hide"),setTimeout(function(){b._removeResource(anchorE)},500),!1}),a(document).on("click",".close-btn",function(){return a(".common-specify-container").hide(),a(".common-specify-container").data("belongs",""),a(".overlay").hide(),a("#inputForm")[0].reset(),a("#inputBox-error").remove(),a(".input-box").removeClass("error"),a(".error-panel").empty().hide(),!1}),a(document).on("click",".add-btn",function(c){c.stopPropagation();var d=a(this),e=d.closest(".common-specify-container").find(".input-box"),f=e.val();return a("#inputForm").valid()&&b._addResources(f),!1}),a(document).on("click",".menu-list .button",function(){var b=a(this);return b.siblings(".button").removeClass("active"),b.addClass("active"),!1}),a(document).on("click",'.nav-tabs li[role="presentation"]',function(){var b=a(this),c=b.find(">a").text(),d=a(".menu-list");return d.find(".menu-title").html(c),"agents"==b.find(">a").data("name")?d.find(".button").show():d.find(".button").hide(),!1})},_addResources:function(b){var c=this,d=",",e=[],f="",g=a(".common-specify-container"),h=g.data("belongs"),i=a("#"+h).find(".resources-list"),j=i.find(".source >span"),k=[],l="",m=/^([0-9a-zA-Z\-\_\.]+,)*[0-9a-zA-Z\-\_\.]+$/;if(j.each(function(b,c){k.push(a(c).text())}),!m.test(b))return void a(".error-panel").html("Please input the valid reource name.").addClass("error").show();e=b.split(d);var n=c._checkIfMutilpleSources(e);return n.res?void a(".error-panel").html('"'+n.duplicatedSrc+'" were inputted more than one time, please remove the duplicate one.').addClass("error").show():(a.each(e,function(b,c){""!==c.trim()&&(k.length>0&&-1!==a.inArray(c,k)&&(l+=c+" "),f+='<div class="source"><span>'+c+'</span><i class="glyphicon glyphicon-remove"></i></div>')}),""!==l?void a(".error-panel").html(l+" already added!").addClass("error").show():(i.append(f),g.hide(),a(".error-panel").empty().hide(),a(".overlay").hide(),void 0))},_checkIfMutilpleSources:function(b){var c=b,d={},e="",f=!1;return a.each(c,function(a,b){""!==b.trim()&&(d[b]&&(f=!0,e+=b+", "),d[b]=b)}),{res:f,duplicatedSrc:e}},_removeResource:function(a){var b=a,c=b.closest("div.source");c.length>0&&c.remove()}}).init()});